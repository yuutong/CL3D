
在主界面上`2`处点击【相机设定】打开

![主界面1](image.png)
 
主要说明触发激光头采集及系统处理的方式、查看本地数据/其他工具/激光头采
集的图像（与触发设定及数据选择有关）、注册基准图像、激光头参数设置用法及对成像效
果的影响。当前文档支持的激光头型号为PVT-LS系列产品，后续添加的产品序列添加之后
将另作说明。

![相机界面](image-1.png)

## 1.触发设定 
此节用来说明触发激光头进行采集以及软件进行处理的几种方式，分别有通信触发、外
部硬触发及关联其他任务。

![触发设定](image-2.png)

### 1.1.通信触发 
通信触发包含无协议的232通信、无协议的TCP通信以及视觉控制器的IO通信，使用
通信触发需要设置触发信号，对应IO的四个输入触发端口（IN0-IN3）可选四个固定的触
发信号（触发1-触发4），使用232及TCP如果使用固定的触发信号则需发送T1/T2/T3/T4，
分别对应触发1-触发4，也可以选择自定义的触发信号，选择之后在后面的输出框输入对应
的触发信号，然后让其他设备端按照自定义设置的触发信号在需要采集及执行时发送触发
信号。

![通信触发](image-3.png)

### 1.2.外部硬触发 
使用外部硬触发则需要在图像采集器的相应端口连接控制触发的IO信号，可以是其他
设备端输出的IO，也可以是传感器的信号，按照采集控制器的连接方法接好即可，当有信
号输入时激光头会开始采集，采集完成后视觉处理系统会处理采集到的点云数据，得到检
测的效果。 

### 1.3.关联其他任务 
使用此方法可以将其他任务中工具的图像、点云以及平面等数据引用到当前配置的任务
中，当其所关联的任务执行完后会自动执行此任务，也就是说此任务是在其所关联的任务
执行完成之后才执行的任务。 

## 2.数据选择 
此处用来选择当前任务注册基准图像以及检测数据的图像/点云来源。

![数据选择](image-4.png)

### 2.1.无数据 
使用此项需要在【触发模式】中选择关联其他任务才有意义，此无数据表示使用当前配
置任务关联其他任务的图像及点云数据，直接选择后直接点击注册基准图像即可，至于当
前任务工具中的处理图像及点云可在每个工具中进行选择。 
### 2.2.本地数据 
表示使用软件目录下的Datas文件夹（一般路径为/opt/.CLVision/Datas，”.”表示隐藏，
需要使用 ctrl+h 使其显示）中的图像/点云文件作为图像/点云数据输入源，一般情况下可
将运行过程中保存的图像及点云数据移动到此文件夹进行检测的重现，可以方便的优化检
测工具的配置参数。 
### 2.3.激光头（CLZN：编码） 
激光头连接线及网线正确连接并且正确配置激光头和控制器IP后，在进行数据选择时
会看到此选项（若未能正常连接则不会出现此选项），使用此选项则表示使用激光头实时采
集到的图像进行检测，在生产线上一般选择此方法作为数据输入源，并且一个激光头可以
在多个任务中被加载，并且可配置不同的激光头参数，主要应用于单激光头多工位检测。 

## 3.注册基准图像 
在进行工具配置前需要先采集一个标准图像（或读取一个本地图像或选择无数据）作为
后续配置工具的依据，如果图像显示窗口有有效的图像及点云数据，则可以点击下图所示
的【基准图像】进行基准图像的注册，如果没有注册基准图像或未成功注册基准图像则在基
准数据后会有标红显示的未注册，如果成功注册基准图像则基准数据后会有标绿的已注册
字样显示。注册的基准图像要与实时检测时的良品图像类似。

![注册基准图像](image-5.png)

## 4.激光头参数设置 
使用激光头需要在选型时进行正确的选型，使用时进行正确的参数配置，以下是在项目中激光
头型号选择需要注意的参数以及使用时根据使用场景需要配置的激光头参数

### 4.1激光头选型参数说明 

![激光头选型](image-12.png)

类似2D相机镜头选型中需要注意的物距、焦距以及视野等，在3D激光头的选型中也需要根据项
目场景选择合适的激光头，下面对选型时需要注意的参数进行如下说明： <br>

**参考距离（CD）**： 表示激光头的安装高度（距离被测物上表面），在此安装高度下进行采
集才可以采集到有效数据，选型时也需要根据现场情况查看是否满足所选型号的安装高度，此数
据用作安装参考数据，后续使用高度还需要进行细调，详见： <br>
**Z 轴高度（FS）**：此数据表示可以检测的产品厚度，只有厚度之内的产品才可以采集到数据。 <br>
**X  轴  宽  度**：此数据表示可以采集的产品宽度，产品长度是由设置参数中的批处理点数
确定的；因激光是类似三角形式散发出去的，所以在有效的采集高度内，距离激光头越近扫描的宽
度越小，距离激光头越远扫描的宽度越大。 <br>
**Z  轴重复精度**：Z方向上同一产品反复多次采集时的重复采集精度。 <br>
**X  轴重复精度**：X方向上同一产品反复多次采集时的重复采集精度。 <br>
**X  轴数据间隔**：表示X方向上每两个采样点之间的间距，即X方向采样。<br> 
**X  轴轮廓点数**：X方向上采集点的最大数量。 <br>
**扫  描 速  度**：即采样频率，表示每秒可以扫描到的脉冲数量；取其倒数表示扫描一次使用的
时间，用此参数可以评估最短的检测周期，需要注意的是：采样频率在2500以内时Z方向扫描范围为
给出的完整范围，采样频率大于2500小于等于4500时Z方向扫描范围为给出范围的1/2，采样频率大于
4500小于等于8000时Z方向扫描范围为给出范围的1/4，需要考量满足检测周期的情况下是否满足测量
高度。 <br>
当然除此之外也需要注意一下安装尺寸，确保在给定的空间下可以安装激光头

### 4.2.激光头安装初使用 
将激光头按照【参考距离】安装接线完成后就可以进行基础的连接及高度调整等工作了，这
里做简单介绍： 
**a. 相  机 连 接**：未使用的激光头控制器的初始连接IP为192.168.10.XXX，需要将其
IP 设置为与视觉控制器同段下的 IP，（视觉控制器 POE1-POE4 网口的 IP 分别为
192.168.100.100、192.168.101.100、192.168.102.100、192.168.103.100）同段的意思是设
置激光头IP前三段数字与其中一个网口IP相同，最后一段数字设置在0-255之内，
但不得与网口IP相同，即不得是标红的数字；详见：附录1：激光头IP初始化更
改步骤。<br> 
**1、 安装高度调整**：将激光头调整到最佳检测高度，详见：附录 2：激光头安装高度调整。 <br>
**2、 倾斜补正调整**：将安装激光头时的手动安装产生的倾斜进行补偿，详见：附录3：激光
头安装倾斜矫正。 <br>

### 4.3.数据参数 
此处用于设置激光头采集图像的光量程度、曝光时间及采样灵敏度等与采集图像/点云
效果有关的参数，可根据此处设置优化采集到的点云数据，结合【数据参数】及【高级配置】
中【拍摄设定】进行说明，可设置的参数如下图所示。

![数据参数](image-7.png)

**感  光  灵 敏 度**：【高精度】因动态范围较小，适用于反射率差较小的对象物体，【高
动态1-4】表示采集时长短曝光比例按照 1->4 的顺序更改设定，可以应对具有更大反射差
率的对象物体，根据采集产品数据点的实际效果进行设置。 <br>
**曝  光   时   间**：设定拍摄元件的最长曝光时间，根据图像效果和采样周期设置。最
长曝光时间受已经设定的采样频率（最快速触发周期）的限制。 <br>
光  亮   控   制：设定亮度的调整范围，该范围由激光光量和曝光时间的组合决定；
【自动】表示使用系统默认光量，【手动】表示自行设置调节范围的控制范围的上限值和下
限值，可在“1 ～ 99”范围内设定。 <br>
**峰  值  灵 敏 度**：设定从图像数据转换为轮廓数据时，检测各X坐标的峰值的“检测
难易度”。从1～5中选择“峰值检测难易度”（选择5时最容易检测到峰值（灵敏度高）、选
择1时最难检测到峰值（灵敏度低））。 <br>
**无效数据补间点数**：无效数据，是指因光量过多或者不足而被视为无法检测出的轮廓数
据。无效数据补间点数在“0～16”范围内设定。轮廓内，当两段有效数据间的无效数据个
数小于补间点数时，无效数据将被置换为直线补间数据。 <br>
**选  择   峰   值**：是指同一X坐标上存在多个峰值时，从下述项目中选择采用哪个<br>
峰值；【标准】：最大的峰值，【NEAR】：最近端(传感头近端)的峰值，【FAR】： 最远端(传感
头远端)的峰值，【使之转为无效数据】：同一X坐标有多个峰值时，作为无效数据处理。 
**峰值宽度过滤器**：与对象物体原有的反射光相比，受环境光和多重反射光影响，感光
峰值的形状有变粗的倾向。利用这种现象，将宽度较粗的峰值视为“可疑峰值”而不执行
检测处理，称为[峰值宽度过滤器]。用于设定是否执行该过滤器处理(设定范围为OFF，1～
10，值越小过滤的效果越明显)。

### 4.4.触发参数 
此处主要用于设置激光头拍摄触发的配置参数，结合【触发参数】及【高级配置】中的
触发设定进行说明，可设置的参数如下所示。 

![触发参数](image-8.png)

**触 发 模式**：触发模式可选择【连续触发】、【外部触发】或【编码器触发】，设为【连续触
发】时，自动连续激活触发，持续执行采样，不受理IO触发输入。选择［编码器触发］时
受理输入至编码器信号输入端子的脉冲信号（增量式编码器输出的信号）作为触发，并且应
设定合适的［编码器类型］和［触发间隔］，选择编码器触发应结合视觉软件的【通信触发】；
选择【外部触发】则通过IO输入端子输入触发，在任意时刻激活触发就执行采样，此处应
结合视觉软件的【外部硬触发】进行使用。 <br>
**编码器类型**：反馈编码器信号的输出类型，有【差分】和【单端】两项，可询问电气人员输
出方式。 <br>
**输 入 模式**：可选择【1相1递增】、【2相1递增】、【2相2递增】及【2相4递增】，【1相
1 递增】表示取反馈脉冲的A相信号的上升沿为触发脉冲，【2相1递增】表示取反馈脉冲
的A相信号的上升沿或下降沿作为触发脉冲，【2相2递增】表示取反馈脉冲的A相信号的
上升沿及下降沿为触发脉冲，【2相4递增】表示取反馈脉冲的A\B相信号的上升沿及下降
沿均作为触发采集的脉冲信号，需要根据驱动器反馈脉冲的实际情况进行选择。 
**细 化 点数**：设置每次间隔多少个编码器脉冲信号后激活触发。例：当编码器一个脉冲信号
为 0.001mm，细化点数设置为 5 时触发间隔为：5*0.001mm=0.005mm，即运动方向间隔为
0.005mm,每隔 0.005mm 后采集一行数据。 <br>
**采 样 频率**：如果触发模式为连续触发，会根据此处设定的周期激活触发；如果触发模式为
编码器触发或外部触发，则此处设定的周期为能够支持的最快触发速度。需要注意的是7000
系列的激光头当Z方向测量范围为【FULL】时，采样频率最大可设置2500，此时Z轴高度
为激光头参数中的Z轴高度，当Z方向测量范围为【MIDDLE】时，采样频率最大可设置
4500，此时Z轴高度为激光头参数中Z轴高度的1/2，当Z方向测量范围为【SMALL】时，
采样频率最大可设置8000此时Z轴高度为激光头参数中Z轴高度的1/4。（Z方向测量范
围的设置位置在【高级设置】中的拍摄设定内，如下图所示） 

![采样频率](image-9.png)

**批处理测量**：选择ON或OFF，ON为开启批处理，OFF关闭批处理。开启批处理进行测
量，会采样“批处理点数”指定的轮廓数后再停止。 <br>
批处理点数：设定1次测量进行处理的轮廓数量，范围50-15000，需要结合产品长度及细化
点数进行设置；采集图像长度= 细化点数 * 批处理点数/ 1000，（单位mm）。 <br>
Y  间  隔：设置取Y方向的数据点时，每一列数据点间的间隔，一般设置为与【X数据间
隔】一致。 

### 4.5.查看编码器触发脉冲个数 
当【触发方式】设置为【编码器触发】时，如果怀疑没有接收到正常的脉冲信号可以查
看下图所示的【编码器值】，查看与所设置的是否一致，进入方式：【相机设定】->【高级配
置】->【实时设定】->【端子】。
![编码器脉冲](image-10.png)

## 5.【轮廓】 
在轮廓中可以选择直线或折线放置在对图像中高度变化感兴趣的位置，点击确认可以显
示出划线经过区域的高度变化（如下图1所示），可辅助用于项目可行性分析及检测参数的
修改中。

![轮廓](image-11.png)